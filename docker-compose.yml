version: "3.9"

services:
  qdrant:
    image: qdrant/qdrant
    container_name: qdrant
    ports:
      - "6333:6333"
    volumes:
      - qdrant_data:/qdrant/storage

  embed-service:
    build: ./scripts
    container_name: embed-service
    command: python embed_service.py
    ports:
      - "5000:5000"
    depends_on:
      - qdrant

  backend:
    build: .
    container_name: backend
    command: npm start
    ports:
      - "4000:4000"
    depends_on:
      - qdrant
      - embed-service
    environment:
      - QDRANT_URL=http://qdrant:6333
      - EMBED_URL=http://embed-service:5000
      - REDIS_URL=redis://redis:6379

  redis:
    image: redis:7
    container_name: redis
    ports:
      - "6380:6379"

  ingest-news:
    build: ./scripts
    container_name: ingest-news
    command: python ingest_news.py
    depends_on:
      - qdrant
      - embed-service
    restart: "no"   

volumes:
  qdrant_data:
